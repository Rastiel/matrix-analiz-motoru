{
    "Teorik -": "# 1. Dosyayı Al (Soldan TEORIK_ESLESME.csv seçili olmalı)\n# Eğer dosya adın farklıysa (örn: TEORIK_EŞLEŞME) burayı düzelt.\ndf = veriler.get('TEORIK_ESLESME') \n\nif df is not None:\n    # 2. Sütun Adını Belirle\n    # Senin verdiğin isim: 'TEO.FIY.FRK.%'\n    hedef_kolon = 'TEO.FIY.FRK.%'\n    \n    # Sütun isimlerindeki gereksiz boşlukları temizle (Hata önleyici)\n    df.columns = df.columns.astype(str).str.strip()\n    \n    # 3. Sütun Var mı Kontrol Et\n    if hedef_kolon in df.columns:\n        # 4. Sayıya Çevir (Kritik Adım)\n        # Excel'den metin olarak geldiyse sıralama yanlış olur (10, 2'den küçük görünür).\n        # Bu yüzden zorla sayı yapıyoruz.\n        df[hedef_kolon] = pd.to_numeric(df[hedef_kolon], errors='coerce').fillna(0)\n        \n        # 5. Sırala (Küçükten Büyüğe -> Eksiler En Üste)\n        # ascending=True demek \"Yükselen\" (Küçük -> Büyük) demektir.\n        sonuc = df.sort_values(hedef_kolon, ascending=True)\n        \n        # Sadece ilgili sütunları göster (Daha temiz görünür)\n        # İstersen bu satırı silip tüm tabloyu görebilirsin.\n        cols = ['SEMBOL', hedef_kolon]\n        # Eğer varsa Fiyat ve Adet'i de ekleyelim\n        if 'TEO.ESLS.FYT' in df.columns: cols.append('TEO.ESLS.FYT')\n        if 'TEO.ESLS.ADET' in df.columns: cols.append('TEO.ESLS.ADET')\n            \n        sonuc = sonuc[cols]\n        \n    else:\n        # Sütun adını tam bulamazsak, benzerini arayalım\n        benzer = [c for c in df.columns if \"FRK\" in c]\n        sonuc = pd.DataFrame([f\"Hata: '{hedef_kolon}' bulunamadı. Benzerleri: {benzer}\"])\nelse:\n    sonuc = pd.DataFrame([\"Lütfen soldan 'TEORIK_ESLESME' dosyasını seçin.\"])",
    "Hacım": "import pandas as pd\nimport numpy as np\n\n# 1. DOSYALARI ÇEK\ndf1 = veriler.get('ACILISLAR-1')\ndf2 = veriler.get('ACILISLAR-2') # Yedek olarak çekelim\n\nif df1 is not None:\n    \n    # --- TEMİZLİK ---\n    def temizle(df):\n        if df is None: return pd.DataFrame()\n        df.columns = df.columns.astype(str).str.strip().str.upper()\n        if len(df.columns) > 0:\n            col_sembol = next((c for c in df.columns if \"SEMBOL\" in c or \"KOD\" in c), df.columns[0])\n            df.rename(columns={col_sembol: 'SEMBOL'}, inplace=True)\n            df['SEMBOL'] = df['SEMBOL'].astype(str).str.strip()\n        return df\n\n    # Hata vermeyen sayı çevirici\n    def sayiya_cevir(s):\n        if isinstance(s, str):\n            s = s.replace('₺', '').replace(',', '').replace(' ', '')\n        val = pd.to_numeric(s, errors='coerce')\n        if pd.isna(val): return 0.0\n        return float(val)\n\n    df1 = temizle(df1.copy())\n    \n    # Eğer 2. dosya varsa birleştir, yoksa 1 ile devam et\n    if df2 is not None:\n        df2 = temizle(df2.copy())\n        master = pd.merge(df1, df2, on='SEMBOL', how='inner')\n    else:\n        master = df1\n\n    # 3. HEDEF: SON 5 GÜN (Sürekli Artış)\n    # Sütunlar: HACIM-4 -> HACIM-3 -> HACIM-2 -> HACIM-1 -> HACIM\n    tum_hacimler = [f'HACIM-{i}' for i in range(4, 0, -1)] + ['HACIM'] \n    \n    # Tabloda var olan sütunları bul ve sayıya çevir\n    mevcut_sutunlar = []\n    for col in tum_hacimler:\n        if col in master.columns:\n            master[col] = master[col].apply(sayiya_cevir)\n            mevcut_sutunlar.append(col)\n\n    # 4. STRATEJİ: MERDİVEN (5 Gün Kuralı)\n    def hacim_kontrol(row):\n        # 1. Son gün hacmi ölü olmasın (En az 10.000 TL)\n        if row.get('HACIM', 0) < 10000: return False\n        \n        # 2. Zincirleme Kontrol (Bugün > Dün > Önceki...)\n        if len(mevcut_sutunlar) < 2: return False\n        \n        for i in range(len(mevcut_sutunlar) - 1):\n            eski_gun = mevcut_sutunlar[i]\n            yeni_gun = mevcut_sutunlar[i+1]\n            \n            # Eğer Yeni <= Eski ise zincir kırılır, artış bitmiştir.\n            if row[yeni_gun] <= row[eski_gun]:\n                return False\n        \n        return True\n\n    # Uygula\n    master['ARTIS_VAR_MI'] = master.apply(hacim_kontrol, axis=1)\n    sonuc_ham = master[master['ARTIS_VAR_MI']].copy()\n\n    if not sonuc_ham.empty:\n        ilk_gun = mevcut_sutunlar[0]\n        son_gun = 'HACIM'\n        \n        # Kaç katına çıktı?\n        sonuc_ham['KAT'] = np.where(sonuc_ham[ilk_gun] > 0, \n                                   (sonuc_ham[son_gun] / sonuc_ham[ilk_gun]), \n                                   0).round(2)\n        \n        # Görsel Format\n        sonuc_ham['HACIM_FMT'] = sonuc_ham[son_gun].apply(lambda x: f\"{x:,.0f}\")\n        \n        # Sıralama: En yüksek son gün hacmine göre\n        final = sonuc_ham.sort_values(by=son_gun, ascending=False)[['SEMBOL', 'HACIM_FMT', 'KAT']]\n        final.columns = ['Hisse', 'Son Hacim', '5 Günlük Artış (Kat)']\n        \n        sonuc = final\n    else:\n        # Hata vermesin diye boş tablo yerine mesaj döndür\n        sonuc = pd.DataFrame({\"Durum\": [\"Son 5 gündür sürekli hacim artıran hisse bulunamadı.\"]})\n\nelse:\n    sonuc = pd.DataFrame({\"Hata\": [\"Lütfen ACILISLAR-1 dosyasını seçin.\"]})",
    "satışlot": "import pandas as pd\nimport numpy as np\n\n# 1. VERİYİ ÇEK\ndf_bekleyen = veriler.get('BEKLEYEN_EMIRLER')\n\nif df_bekleyen is not None:\n    \n    # --- TEMİZLİK VE BAŞLIK BULMA ---\n    def temizle_ve_baslik_bul(df):\n        # Başlık satırını bul\n        header_idx = -1\n        for i in range(min(20, len(df))):\n            row = df.iloc[i].astype(str).str.upper().tolist()\n            if any(x in row for x in [\"SEMBOL\", \"KOD\", \"ALS\", \"STS\", \"ADET\"]):\n                header_idx = i\n                break\n        \n        if header_idx != -1:\n            df.columns = df.iloc[header_idx]\n            df = df.iloc[header_idx+1:].reset_index(drop=True)\n            \n        df.columns = df.columns.astype(str).str.strip().str.upper().str.replace(' ', '_')\n        \n        col_sembol = next((c for c in df.columns if \"SEMBOL\" in c or \"KOD\" == c), None)\n        if col_sembol:\n            df.rename(columns={col_sembol: 'SEMBOL'}, inplace=True)\n            df['SEMBOL'] = df['SEMBOL'].astype(str).str.strip()\n            \n        return df\n\n    # Hata vermeyen sayı çevirici\n    def sayiya_cevir(s):\n        if isinstance(s, str):\n            s = s.replace('₺', '').replace(',', '').replace('.', '')\n        val = pd.to_numeric(s, errors='coerce')\n        if pd.isna(val): return 0.0\n        return float(val)\n\n    # Temizlik Yap\n    df = temizle_ve_baslik_bul(df_bekleyen.copy())\n\n    # --- SÜTUNLARI BUL ---\n    col_alis_adet = next((c for c in df.columns if \"ALS\" in c and \"ADET\" in c and \"TOP\" in c), None)\n    col_satis_adet = next((c for c in df.columns if \"STS\" in c and \"ADET\" in c and \"TOP\" in c), None)\n\n    if col_alis_adet and col_satis_adet:\n        # Sayıya Çevir\n        df[col_alis_adet] = df[col_alis_adet].apply(sayiya_cevir)\n        df[col_satis_adet] = df[col_satis_adet].apply(sayiya_cevir)\n\n        # --- DÜZELTME BURADA ---\n        # Artık ayırıp birleştirmiyoruz. Direkt ana tabloyu kullanıyoruz.\n        # Sadece ilgili sütunları seçiyoruz.\n        \n        final_table = df[['SEMBOL', col_alis_adet, col_satis_adet]].copy()\n        final_table.columns = ['Hisse', 'Bekleyen Alış (Lot)', 'Bekleyen Satış (Lot)']\n        \n        # Alış/Satış Oranı (Derinlik Gücü)\n        # Alıcılar satıcılardan ne kadar güçlü?\n        final_table['Alış/Satış Gücü'] = np.where(final_table['Bekleyen Satış (Lot)'] > 0, \n                                                 (final_table['Bekleyen Alış (Lot)'] / final_table['Bekleyen Satış (Lot)']), \n                                                 0).round(2)\n\n        # --- SIRALAMA ---\n        # Bekleyen ALIŞ miktarına göre sırala (En çok alıcısı olan en üstte)\n        sonuc = final_table.sort_values('Bekleyen Alış (Lot)', ascending=False)\n        \n        # Formatlama\n        sonuc['Bekleyen Alış (Lot)'] = sonuc['Bekleyen Alış (Lot)'].apply(lambda x: f\"{x:,.0f}\")\n        sonuc['Bekleyen Satış (Lot)'] = sonuc['Bekleyen Satış (Lot)'].apply(lambda x: f\"{x:,.0f}\")\n\n    else:\n        sonuc = pd.DataFrame([f\"Hata: Bekleyen Emir sütunları bulunamadı. Mevcut sütunlar: {df.columns.tolist()}\"])\n\nelse:\n    sonuc = pd.DataFrame([\"Lütfen BEKLEYEN_EMIRLER dosyasını seçin.\"])",
    "Bekleyen emirler tavan ": "import pandas as pd\nimport numpy as np\n\n# 1. VERİYİ ÇEK\ndf_bekleyen = veriler.get('BEKLEYEN_EMIRLER')\n\nif df_bekleyen is not None:\n    \n    # --- TEMİZLİK VE BAŞLIK BULMA ---\n    def temizle_ve_baslik_bul(df):\n        if df is None or df.empty: return pd.DataFrame()\n        \n        # Başlık satırını ara (İlk 30 satırda)\n        header_idx = -1\n        for i in range(min(30, len(df))):\n            row = df.iloc[i].astype(str).str.upper().tolist()\n            if any(x in row for x in [\"SEMBOL\", \"KOD\", \"ALS\", \"STS\", \"ADET\", \"ALIS\"]):\n                header_idx = i\n                break\n        \n        if header_idx != -1:\n            df.columns = df.iloc[header_idx]\n            df = df.iloc[header_idx+1:].reset_index(drop=True)\n            \n        df.columns = df.columns.astype(str).str.strip().str.upper().str.replace(' ', '_')\n        \n        col_sembol = next((c for c in df.columns if \"SEMBOL\" in c or \"KOD\" == c), None)\n        if col_sembol:\n            df.rename(columns={col_sembol: 'SEMBOL'}, inplace=True)\n            df['SEMBOL'] = df['SEMBOL'].astype(str).str.strip()\n            df = df[df['SEMBOL'].notna() & (df['SEMBOL'] != '')] # Boş satırları temizle\n            \n        return df\n\n    # Sayı Çevirici\n    def sayiya_cevir(s):\n        if isinstance(s, str):\n            s = s.replace('₺', '').replace('.', '').replace(',', '')\n        try:\n            return float(s)\n        except:\n            return 0.0\n\n    # Temizlik\n    df = temizle_ve_baslik_bul(df_bekleyen.copy())\n\n    # Sütunları Bul\n    col_alis_adet = next((c for c in df.columns if (\"ALS\" in c or \"ALIS\" in c) and \"ADET\" in c and \"HACIM\" not in c), None)\n    col_satis_adet = next((c for c in df.columns if (\"STS\" in c or \"SATIS\" in c) and \"ADET\" in c and \"HACIM\" not in c), None)\n\n    if col_alis_adet and col_satis_adet:\n        # Sayıya Çevir\n        df[col_alis_adet] = df[col_alis_adet].apply(sayiya_cevir)\n        df[col_satis_adet] = df[col_satis_adet].apply(sayiya_cevir)\n\n        # Tabloyu Hazırla\n        final_table = df[['SEMBOL', col_alis_adet, col_satis_adet]].copy()\n        final_table.columns = ['Hisse', 'Alis_Lot', 'Satis_Lot']\n        \n        # Ölüleri Temizle (Hem alış hem satış 0 ise at)\n        final_table = final_table[~((final_table['Alis_Lot'] == 0) & (final_table['Satis_Lot'] == 0))]\n\n        # --- YENİ SIRALAMA MANTIĞI ---\n        \n        # 1. Grup: TAVANLAR (Satıcısı 0 Olanlar) -> Alış Lotuna Göre Sırala\n        tavanlar = final_table[final_table['Satis_Lot'] <= 0].copy()\n        tavanlar = tavanlar.sort_values(by='Alis_Lot', ascending=False)\n        \n        # 2. Grup: NORMALLER (Satıcısı Olanlar)\n        # Burayı \"TOPLAM LOT\" (Derinlik) büyüklüğüne göre sıralıyoruz.\n        # Böylece hem alıcısı hem satıcısı çok olan \"Baba Hisseler\" üste gelir.\n        normaller = final_table[final_table['Satis_Lot'] > 0].copy()\n        normaller['Toplam_Derinlik'] = normaller['Alis_Lot'] + normaller['Satis_Lot']\n        normaller = normaller.sort_values(by='Toplam_Derinlik', ascending=False)\n        \n        # 3. Birleştir\n        sonuc = pd.concat([tavanlar, normaller], ignore_index=True)\n        \n        # Ekstra: Güç Göstergesi\n        sonuc['Güç'] = np.where(sonuc['Satis_Lot'] > 0, \n                               (sonuc['Alis_Lot'] / sonuc['Satis_Lot']), \n                               999).round(2)\n        \n        # --- GÖRSEL FORMATLAMA ---\n        sonuc['Bekleyen Alış (Lot)'] = sonuc['Alis_Lot'].apply(lambda x: f\"{x:,.0f}\")\n        sonuc['Bekleyen Satış (Lot)'] = sonuc['Satis_Lot'].apply(lambda x: f\"{x:,.0f}\")\n        sonuc['Güç'] = sonuc['Güç'].astype(str).replace('999.0', 'TAVAN')\n        \n        # Gereksizleri at, tabloyu sun\n        sonuc = sonuc[['Hisse', 'Bekleyen Alış (Lot)', 'Bekleyen Satış (Lot)', 'Güç']]\n\n    else:\n        sonuc = pd.DataFrame([f\"Hata: Sütunlar bulunamadı. Mevcut: {df.columns.tolist()}\"])\n\nelse:\n    sonuc = pd.DataFrame([\"Lütfen BEKLEYEN_EMIRLER dosyasını seçin.\"])",
    "Tüm tablo adları": "import pandas as pd\n\n# Sonuçları toplayacağımız liste\nbaslik_listesi = []\n\n# Sistemdeki yüklü tüm dosyaları tara\nfor dosya_adi, df in veriler.items():\n    if df is not None and not df.empty:\n        # 1. Dosya ismini temizle (.csv uzantısını at)\n        temiz_ad = dosya_adi.replace(\".csv\", \"\").replace(\".xlsx\", \"\")\n        \n        # 2. Sütun başlıklarını al\n        sutunlar = df.columns.tolist()\n        \n        # 3. Listeye ekle (Yan yana okunabilir formatta)\n        baslik_listesi.append({\n            \"DOSYA ADI\": temiz_ad,\n            \"SÜTUN SAYISI\": len(sutunlar),\n            \"SÜTUN BAŞLIKLARI\": \", \".join(sutunlar)  # Yan yana virgülle dizer\n        })\n\n# Sonucu DataFrame'e çevir\ndf_sonuc = pd.DataFrame(baslik_listesi)\n\n# Görsellik için sıralama yapalım (İsme göre)\ndf_sonuc = df_sonuc.sort_values(by=\"DOSYA ADI\").reset_index(drop=True)\n\n# Sonucu ekrana bas (Bu sistemde df_sonuc otomatik gösterilir)\nsonuc = df_sonuc"
}